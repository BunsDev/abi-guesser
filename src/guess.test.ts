import { AbiCoder, FunctionFragment, Interface, ParamType } from 'ethers';
import { guessFragment } from './guess';

const jestConsole = console;

beforeEach(() => {
    global.console = require('console');
});

afterEach(() => {
    global.console = jestConsole;
});

type HandwrittenTestcase = {
    name: string;
    signature: string;
    args: any[];
};

type ChainTestcase = {
    id: string;
    signature: string;
    calldata: string;
};

const handwrittenTestcases: HandwrittenTestcase[] = [
    {
        name: 'empty array',
        signature: 'func(bytes32[])',
        args: [[]],
    },
    {
        name: 'empty string',
        signature: 'func(string)',
        args: [''],
    },
    {
        name: 'empty tuple',
        signature: 'func()',
        args: [],
    },
    {
        name: 'simple uint',
        signature: 'func(uint256)',
        args: [123],
    },
    {
        name: 'simple bytes32',
        signature: 'func(bytes32)',
        args: ['0xaabbccddeeffaabbccddeeffaabbccddeeffaabbccddeeffaabbccddeeffaabb'],
    },
    {
        name: 'simple bytes4',
        signature: 'func(bytes4)',
        args: ['0xabcdabcd'],
    },
    // i dont wanna make the type stripper handle this
    // {
    //     name: 'uint array/bytes confusion',
    //     signature: 'func(uint256[])',
    //     args: [[BigNumber.from("0x8000000000000000000000000000000000000000000000000000000000000000")]]
    // },
    {
        name: 'uint array/bytes confusion',
        signature: 'func(bytes)',
        args: ['0x80'],
    },
    {
        name: 'fixed sized uint array',
        signature: 'func(uint256[5])',
        args: [[123, 456, 789, 135, 790]],
    },
    {
        name: 'dynamic size uint array',
        signature: 'func(uint256[])',
        args: [[123, 456, 789, 135, 790]],
    },
    {
        name: 'simple bytes',
        signature: 'func(bytes)',
        args: ['0xababcdcddeadbeef'],
    },
    {
        name: 'short string',
        signature: 'func(string)',
        args: ['short string'],
    },
    {
        name: 'long string',
        signature: 'func(string)',
        args: ['this is a very long string paddingpaddingpaddingpaddingpaddingpaddingpaddingpaddingpaddingpadding'],
    },
    {
        name: 'long string array',
        signature: 'func(string[])',
        args: [
            [
                'this is a very long string paddingpaddingpaddingpaddingpaddingpaddingpaddingpaddingpaddingpadding',
                'this is a very long string paddingpaddingpaddingpaddingpaddingpaddingpaddingpaddingpaddingpadding',
                'this is a very long string paddingpaddingpaddingpaddingpaddingpaddingpaddingpaddingpaddingpadding',
            ],
        ],
    },
    {
        name: 'top level tuple',
        signature: 'func((uint256, uint256, bytes4))',
        args: [[10, 20, '0xcafebabe']],
    },
    {
        name: 'array of tuples',
        signature: 'func((uint256, uint256, bytes4)[])',
        args: [
            [
                [10, 20, '0xcafebabe'],
                [30, 40, '0xf00df00d'],
            ],
        ],
    },
    {
        name: 'string in array of tuples',
        signature: 'func((string, uint256)[])',
        args: [
            [
                ['alice', 0x1234],
                ['bob', 0x4321],
            ],
        ],
    },
    {
        name: 'string in array of single-component tuple',
        signature: 'func((string)[])',
        args: [[['alice'], ['bob']]],
    },
    {
        name: 'array of strings',
        signature: 'func(string[])',
        args: [['hello', 'world']],
    },
    {
        name: 'array of tuple containing two dynamic elements',
        signature: 'func((string, uint256[])[])',
        args: [
            [
                ['alice', [1, 2, 3]],
                ['bob', [4, 5, 6]],
            ],
        ],
    },
    {
        name: 'array of tuple of array of tuple',
        signature: 'func((string, (string, uint256[])[])[])',
        args: [
            [
                [
                    'alice',
                    [
                        ['microsoft', [1, 2, 3]],
                        ['windows', [5, 5, 5]],
                    ],
                ],
                [
                    'bob',
                    [
                        ['apple', [4, 5, 6]],
                        ['osx', [4, 5, 6]],
                    ],
                ],
            ],
        ],
    },
    {
        name: 'empty top level array',
        signature: 'func((string, bytes, uint256)[],(uint256,uint256)[][])',
        args: [
            [],
            [
                [
                    [0xaabb, 0xccdd],
                    [0x1234, 0x5678],
                ],
                [
                    [0xffff, 0xeeee],
                    [0xdddd, 0xcccc],
                ],
            ],
        ],
    },
];

const chainTestcases: ChainTestcase[] = [
    {
        id: 'ethereum/0x3db540d6e84bd6fdc53b811fed04b503a451badea2c8c4d2ff6919d7bbde7d0d',
        signature:
            'addSequencerL2BatchFromOrigin(uint256 sequenceNumber,bytes data,uint256 afterDelayedMessagesRead,address gasRefunder,uint256 prevMessageCount,uint256 newMessageCount)',
        calldata:
            '0x8f111f3c00000000000000000000000000000000000000000000000000000000000016fb00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000017bef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014ce3f000000000000000000000000000000000000000000000000000000000014cf0b00000000000000000000000000000000000000000000000000000000000000b288ee2038d9137f102613836e42b5fac1c733433d66a4bdfef97dd495bff5dbed1293a46ab6da69c5fab714f92d8b4accd750f2b80e199312118ff156fa9a417a840000000063a206f9010000000000000077107c919c3bc4ee6618239559ebc48a5f25334bb563eb0283df2f9ed6f4c7166919346d74616eb81ec151768e6b6ef55509d82a5e30eecc81981dcc36ce555ba7a06151bf1bd330fca88b4b6e5d057f638367e671b2f2c6909dad10cbe90993380000000000000000000000000000',
    },
    {
        id: 'ethereum/0x6150a49f6f56582f17d7ac808b6521f37f6a68a0b8ddabcd2e1cc86f76fb4e2f',
        signature:
            'joinPool(bytes32 poolId, address sender, address recipient, tuple(address[] assets, uint256[] maxAmountsIn, bytes userData, bool fromInternalBalance) request)',
        calldata:
            '0xb95cac2896646936b91d6b9d7d0c47c496afbf3d6ec7b6f8000200000000000000000019000000000000000000000000111a66bec9536af6da69dd198f5252857dfb2fb1000000000000000000000000111a66bec9536af6da69dd198f5252857dfb2fb10000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000001d4c0000000000000000000000000000000000000000000000000000056ef6eeb07a500000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000152c2bd0742d240000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000001d4c0000000000000000000000000000000000000000000000000000056ef6eeb07a5',
    },
    {
        id: 'ethereum/0x973646c73b52f72f7f1b813f4cc9a7c7ee531d16f3d7d1303bf3915065775acc',
        signature:
            'fulfillAvailableAdvancedOrders(tuple(tuple(address offerer, address zone, tuple(uint8 itemType, address token, uint256 identifierOrCriteria, uint256 startAmount, uint256 endAmount)[] offer, tuple(uint8 itemType, address token, uint256 identifierOrCriteria, uint256 startAmount, uint256 endAmount, address recipient)[] consideration, uint8 orderType, uint256 startTime, uint256 endTime, bytes32 zoneHash, uint256 salt, bytes32 conduitKey, uint256 totalOriginalConsiderationItems) parameters, uint120 numerator, uint120 denominator, bytes signature, bytes extraData)[] advancedOrders, tuple(uint256 orderIndex, uint8 side, uint256 index, uint256 identifier, bytes32[] criteriaProof)[] criteriaResolvers, tuple(uint256 orderIndex, uint256 itemIndex)[][] offerFulfillments, tuple(uint256 orderIndex, uint256 itemIndex)[][] considerationFulfillments, bytes32 fulfillerConduitKey, address recipient, uint256 maximumFulfilled) payable returns (bool[] availableOrders, tuple(tuple(uint8 itemType, address token, uint256 identifier, uint256 amount, address recipient) item, address offerer, bytes32 conduitKey)[] executions)',
        calldata:
            '0x87201b4100000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000004de00000000000000000000000000000000000000000000000000000000000004e0000000000000000000000000000000000000000000000000000000000000055a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002f80f930af7ae24905e1dfc153d11d3ab0b0be5a000000000000000000000000000000000000000000000000000000000000000f000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000006e00000000000000000000000000000000000000000000000000000000000000be000000000000000000000000000000000000000000000000000000000000010e000000000000000000000000000000000000000000000000000000000000015e00000000000000000000000000000000000000000000000000000000000001ae00000000000000000000000000000000000000000000000000000000000001fe000000000000000000000000000000000000000000000000000000000000024e000000000000000000000000000000000000000000000000000000000000029e00000000000000000000000000000000000000000000000000000000000002ee000000000000000000000000000000000000000000000000000000000000033e000000000000000000000000000000000000000000000000000000000000038e00000000000000000000000000000000000000000000000000000000000003de000000000000000000000000000000000000000000000000000000000000042e000000000000000000000000000000000000000000000000000000000000047e000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e000000000000000000000000034a1b177dc6595c0645be857f3d454fc8efd6f9d000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e3d650000000000000000000000000000000000000000000000000000000063b71b400000000000000000000000000000000000000000000000000000000000000000360c6ebe000000000000000000000000000000000000000060292c17aa045daa0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f3220000000000000000000000000000000000000000000000000000000000000322000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c6768fefab000000000000000000000000000000000000000000000000000001c6768fefab00000000000000000000000000034a1b177dc6595c0645be857f3d454fc8efd6f9d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba72482dd0000000000000000000000000000000000000000000000000000000ba72482dd0000000000000000000000000000000a26b00c1f0df003000390027140000faa719000000000000000000000000000000000000000000000000000000000000004122464f7cca9994d8ff170537aba3fae041be426fe9d80e12199bf460a0d7b43175d141875e8b8f75cfb40b689fb827d365b42ee1efc6744a06b2f2d314fedf7c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e0000000000000000000000000e59dc1d23bdc21a72a85c71844c3a5917651cffc000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e3f1a0000000000000000000000000000000000000000000000000000000063b5cc1a300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000858c1a76b917d4427c19d17c2868fb420000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f32200000000000000000000000000000000000000000000000000000000000002a7000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e7b76ec2c4000000000000000000000000000000000000000000000000000001e7b76ec2c4000000000000000000000000000e59dc1d23bdc21a72a85c71844c3a5917651cffc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c816bdd9c0000000000000000000000000000000000000000000000000000000c816bdd9c0000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000041f247597540bf1b4023073b6ea99dc41b58ad8e7897face53852ba28a07c869c0564586250d7ffffd79ada54f11141e8568f33d47ceb263c9f9eeef20413790271c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000002878d683f7855bf6305f24d98c7ce70226e3cb05000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e3f200000000000000000000000000000000000000000000000000000000063b5cc203000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001955c64b19b125266b401f8f86ded5390000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f32200000000000000000000000000000000000000000000000000000000000002b3000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c6768fefab000000000000000000000000000000000000000000000000000001c6768fefab0000000000000000000000000002878d683f7855bf6305f24d98c7ce70226e3cb050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba72482dd0000000000000000000000000000000000000000000000000000000ba72482dd0000000000000000000000000000000a26b00c1f0df003000390027140000faa71900000000000000000000000000000000000000000000000000000000000000417f872c13fb2092c151402605dbdfa1cfb7e6556cb4321acabcfcbd32e1c721422f94d3b43c4388618487c77a1576a2cfc0e1f83ec407219e55ae845752b7a67c1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e0000000000000000000000000156f04654e110d95be25e129845fa2b93db5f6aa000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e3e3c00000000000000000000000000000000000000000000000000000000647b846c300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d1ca9e2337d1600cb70b58700bcc7cfa0000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f3220000000000000000000000000000000000000000000000000000000000000297000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001bb60f053f8000000000000000000000000000000000000000000000000000001bb60f053f8000000000000000000000000000156f04654e110d95be25e129845fa2b93db5f6aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b5e620f480000000000000000000000000000000000000000000000000000000b5e620f480000000000000000000000000000000a26b00c1f0df003000390027140000faa71900000000000000000000000000000000000000000000000000000000000000410fbdfd69fd19fd0bccce1cdccfa15a41b91671b59aa27bcc7c0756c71ddc46ce1f30600d80763546fecdb85fd37783484d8eeab7d96011af30544dc96c1bdef21c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e000000000000000000000000088106159fab8669a30976f50827a0ca064974826000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e3e4500000000000000000000000000000000000000000000000000000000647b847530000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000094981f3de47b20d9207df66e99e510000000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f3220000000000000000000000000000000000000000000000000000000000000299000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001bb60f053f8000000000000000000000000000000000000000000000000000001bb60f053f800000000000000000000000000088106159fab8669a30976f50827a0ca0649748260000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b5e620f480000000000000000000000000000000000000000000000000000000b5e620f480000000000000000000000000000000a26b00c1f0df003000390027140000faa71900000000000000000000000000000000000000000000000000000000000000414345f5fa3d718774c5c29c4a1967dd9185bd4a9de73580740ce50923655f51ba51f467dc60bb665df11cf7e3f416834e61ed152aa58623ad5460dceec1e109e41b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e000000000000000000000000039d295313d41c784dafc83e3f70f16baa438cd9e000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e3f1d0000000000000000000000000000000000000000000000000000000063b5cc1d300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a50d188a78cfdd3b4f4042ccc4ba61490000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f32200000000000000000000000000000000000000000000000000000000000002a2000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001c6768fefab000000000000000000000000000000000000000000000000000001c6768fefab00000000000000000000000000039d295313d41c784dafc83e3f70f16baa438cd9e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba72482dd0000000000000000000000000000000000000000000000000000000ba72482dd0000000000000000000000000000000a26b00c1f0df003000390027140000faa719000000000000000000000000000000000000000000000000000000000000004186ba31f8c1dfa7001ddbfd20a18311a529d46247dd02e570c01996e9d580bd4e6435e2dbd6d7cc19652e68273388e3cf19e9f146596b649f74f11118f3603d321b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000003b05e72c00165d255b761a97b9cac24c3faa16f1000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e3e4800000000000000000000000000000000000000000000000000000000647b84783000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002737d7b730b9660fab31e9d978d9f9c20000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f322000000000000000000000000000000000000000000000000000000000000029a000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001bb60f053f8000000000000000000000000000000000000000000000000000001bb60f053f80000000000000000000000000003b05e72c00165d255b761a97b9cac24c3faa16f10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b5e620f480000000000000000000000000000000000000000000000000000000b5e620f480000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000041c68fceed22c4e98e0c5679c769b060b1793a3652dc6671792ca9815f5be940661f6aae26462e8fd667673a6d38d42c4925e2fc00cd6bb68c7bea9742e7aea1f91b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e0000000000000000000000000e27e8f15975c14900867075fe8fbd80e2f8e5dca000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e3dec0000000000000000000000000000000000000000000000000000000063b5caed000000000000000000000000000000000000000000000000000000000000000072db8c0b00000000000000000000000000000000000000001e719dc003b620240000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f322000000000000000000000000000000000000000000000000000000000000025b000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001cc015fbd84800000000000000000000000000000000000000000000000000001cc015fbd84800000000000000000000000000e27e8f15975c14900867075fe8fbd80e2f8e5dca0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bcb85bca78000000000000000000000000000000000000000000000000000000bcb85bca78000000000000000000000000000000a26b00c1f0df003000390027140000faa719000000000000000000000000000000000000000000000000000000000000004104a1512c400ffa1725e28ddd3d078f8308f2f29a870dad6d6145476d38644ff41d245133569fd16bc65979327506a989f11b58363be6c18539a208f83b391c761b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e0000000000000000000000000e0718619a0c2fa4b837d7ff54b4f5c63a65333cc000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e3dec0000000000000000000000000000000000000000000000000000000063b5caed000000000000000000000000000000000000000000000000000000000000000072db8c0b0000000000000000000000000000000000000000b7d0872bb56121f00000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f3220000000000000000000000000000000000000000000000000000000000000261000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e7b76ec2c4000000000000000000000000000000000000000000000000000001e7b76ec2c4000000000000000000000000000e0718619a0c2fa4b837d7ff54b4f5c63a65333cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c816bdd9c0000000000000000000000000000000000000000000000000000000c816bdd9c0000000000000000000000000000000a26b00c1f0df003000390027140000faa71900000000000000000000000000000000000000000000000000000000000000414dd2dcef61c88ccba6f4990169e8fdf2d4b1f674031aa53b5846e9cb4b54aa12605b80607a6ba7df689895d17b18feac48274e10ab2c86b05d81a18170b981681c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000003e011c971e41705bb7fc39982d9f42a1a57405c8000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e3dec0000000000000000000000000000000000000000000000000000000063b5caed000000000000000000000000000000000000000000000000000000000000000072db8c0b00000000000000000000000000000000000000006b06c3bd875211b80000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f3220000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001d716ff5937800000000000000000000000000000000000000000000000000001d716ff59378000000000000000000000000003e011c971e41705bb7fc39982d9f42a1a57405c80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c1448303c8000000000000000000000000000000000000000000000000000000c1448303c8000000000000000000000000000000a26b00c1f0df003000390027140000faa71900000000000000000000000000000000000000000000000000000000000000411b002b960e5f70d242dc82f4f432c1645af1f6fd6833ef210e3c2b0186b9a4cc1a57be73a9a30d14ddabc24c840a54efef46ce0050221782380c3d0fc87c3c7b1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e0000000000000000000000000fa7b53949538e4a88dfedf0a32588c49504c0042000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e3d990000000000000000000000000000000000000000000000000000000063b5ca9a000000000000000000000000000000000000000000000000000000000000000072db8c0b000000000000000000000000000000000000000050f4018e57ee61380000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f3220000000000000000000000000000000000000000000000000000000000000163000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001dca1cf2711000000000000000000000000000000000000000000000000000001dca1cf2711000000000000000000000000000fa7b53949538e4a88dfedf0a32588c49504c00420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c38a96a070000000000000000000000000000000000000000000000000000000c38a96a070000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000041d03cb98221d861b201d565e0829461f0067926f97f782755280a12c4079fdeb909a536b0b9984d772eaf42d201877f7ad36126ff3947e1e04631fe11dd2511fc1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e0000000000000000000000000c3e295d3893ae9c8f5cfbd0d8a02e647378fab69000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e37cd0000000000000000000000000000000000000000000000000000000063b5c4ce000000000000000000000000000000000000000000000000000000000000000072db8c0b0000000000000000000000000000000000000000dc10ee71a39962900000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f3220000000000000000000000000000000000000000000000000000000000000123000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ed423e909d800000000000000000000000000000000000000000000000000001ed423e909d800000000000000000000000000c3e295d3893ae9c8f5cfbd0d8a02e647378fab690000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ca5cd17668000000000000000000000000000000000000000000000000000000ca5cd17668000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000041347d7f21a6bbb2219570b919d025fa11033dbc6048834a37db2da4b31f4d3c0b6e630cc4764b7e7ed780f4b15a17cfa3df8335f9ae1ea574d86ebfeb0fc9ac1e1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000006d40c189e25101e320b5fb145dadff14fb81b462000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e37cd0000000000000000000000000000000000000000000000000000000063b5c4ce000000000000000000000000000000000000000000000000000000000000000072db8c0b00000000000000000000000000000000000000005ba53679c8425ee00000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f3220000000000000000000000000000000000000000000000000000000000000126000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ed423e909d800000000000000000000000000000000000000000000000000001ed423e909d8000000000000000000000000006d40c189e25101e320b5fb145dadff14fb81b4620000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ca5cd17668000000000000000000000000000000000000000000000000000000ca5cd17668000000000000000000000000000000a26b00c1f0df003000390027140000faa71900000000000000000000000000000000000000000000000000000000000000411cacd578eab5f0bff94fdd2a4bd610c4ac538671d05de75cff5e7698db31f45277eeeb6502c8873b022a5c9c13a1aa98a9f9fd6c99a665dd9f1ea551037d8ee91c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000009d6a0d299230bfb8310025bc16f651dd2811172c000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e37cd0000000000000000000000000000000000000000000000000000000063b5c4ce000000000000000000000000000000000000000000000000000000000000000072db8c0b00000000000000000000000000000000000000006721bf07631d9f180000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f3220000000000000000000000000000000000000000000000000000000000000122000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ed423e909d800000000000000000000000000000000000000000000000000001ed423e909d8000000000000000000000000009d6a0d299230bfb8310025bc16f651dd2811172c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ca5cd17668000000000000000000000000000000000000000000000000000000ca5cd17668000000000000000000000000000000a26b00c1f0df003000390027140000faa7190000000000000000000000000000000000000000000000000000000000000041dd993c8c5793dd39bb6569c507dc936a07f2c6529e2eaed5540215bcd59ac1ee0a95f249af655f052360326f5aa490ced38b08032c35f80168e580155383c11f1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e00000000000000000000000008e26bddc7f96146bf3c719aeca22e2cfb98ec760000000000000000000000000004c00500000ad104d7dbd00e3ae0a5c00560c0000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000638e34ce00000000000000000000000000000000000000000000000000000000638f864e0000000000000000000000000000000000000000000000000000000000000000360c6ebe0000000000000000000000000000000000000000c56ad6bd305da9c90000007b02230091a7ed01230072f7006a004d60a8d4e71d599b8104250f000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000076d7ee9e913cbbe0e6f8cf5ca192dac841e4f3220000000000000000000000000000000000000000000000000000000000000033000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001e19ebd6054c00000000000000000000000000000000000000000000000000001e19ebd6054c000000000000000000000000008e26bddc7f96146bf3c719aeca22e2cfb98ec7600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c5967513d4000000000000000000000000000000000000000000000000000000c5967513d4000000000000000000000000000000a26b00c1f0df003000390027140000faa719000000000000000000000000000000000000000000000000000000000000004149981252f77890aca68251003aeec98ff6dbbbdd085533a7352a01bff67d42aa38e6db2033f359c43e2157a40d3340f4e5c2a08c595b6d9e5c7538db73ae3fba1b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000002a00000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000003c00000000000000000000000000000000000000000000000000000000000000420000000000000000000000000000000000000000000000000000000000000048000000000000000000000000000000000000000000000000000000000000004e0000000000000000000000000000000000000000000000000000000000000054000000000000000000000000000000000000000000000000000000000000005a00000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000066000000000000000000000000000000000000000000000000000000000000006c000000000000000000000000000000000000000000000000000000000000007200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000064000000000000000000000000000000000000000000000000000000000000006a00000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000076000000000000000000000000000000000000000000000000000000000000007c00000000000000000000000000000000000000000000000000000000000000820000000000000000000000000000000000000000000000000000000000000088000000000000000000000000000000000000000000000000000000000000008e0000000000000000000000000000000000000000000000000000000000000094000000000000000000000000000000000000000000000000000000000000009a00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000a600000000000000000000000000000000000000000000000000000000000000ac00000000000000000000000000000000000000000000000000000000000000b20000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000090000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000b0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000d0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000000072db8c0b',
    },
    {
        id: 'ethereum/0x92442a1e4461251276fefe29fb9378d50b16d59eb259bf01a22293d0da2a1b5a',
        signature:
            'matchAdvancedOrders(((address,address,(uint8,address,uint256,uint256,uint256)[],(uint8,address,uint256,uint256,uint256,address)[],uint8,uint256,uint256,bytes32,uint256,bytes32,uint256),uint120,uint120,bytes,bytes)[],(uint256,uint8,uint256,uint256,bytes32[])[],((uint256,uint256)[],(uint256,uint256)[])[],address)',
        calldata:
            '0xf2d12b12000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000009c00000000000000000000000000000000000000000000000000000000000000ba0000000000000000000000000af708ad676a9558206e108afc07bd798dda0dafd00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000054000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000046000000000000000000000000000000000000000000000000000000000000004e0000000000000000000000000f0e16c071e2cd421974dcb76d9af4dedb578e05900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000063e541f60000000000000000000000000000000000000000000000000000000063ee7c710000000000000000000000000000000000000000000000000000000000000000360c6ebe000000000000000000000000000000000000000063fe48f48e7e52900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002386f26fc10000000000000000000000000000000000000000000000000000002386f26fc10000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000cdd3cb3bcd969c2b389488b51fb093cc0d703b12b3615d177f5c1f41577cf3b3bb8276a73251eb66c92ee1df8903e6664c3a04700000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000f0e16c071e2cd421974dcb76d9af4dedb578e0590000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e35fa931a0000000000000000000000000000000000000000000000000000000e35fa931a0000000000000000000000000000000a26b00c1f0df003000390027140000faa71900000000000000000000000000000000000000000000000000000000000000419c8f476f1e5dc44204c7c4585bc1e933e6c2d3fe7e2b6828cdde2660c99b78e0575c7d5fa43d70f00356eb98fe43820e93951bd4f7e479f32d3ac9a34014af021b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000003a000000000000000000000000000000000000000000000000000000000000003c0000000000000000000000000af708ad676a9558206e108afc07bd798dda0dafd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000063e541f60000000000000000000000000000000000000000000000000000000063ee7c710000000000000000000000000000000000000000000000000000000000000000360c6ebe0000000000000000000000000000000000000000fce6253acc89ffdb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000020000000000000000000000000cdd3cb3bcd969c2b389488b51fb093cc0d703b100000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000022a392c68f60000000000000000000000000000000000000000000000000000022a392c68f6000000000000000000000000000af708ad676a9558206e108afc07bd798dda0dafd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000007c43c1e24e1884c4e28a16bbd9506f60b5ca9f18fc90635e729d3cfe13abcf001e957c7088cc514af737d51c00cc6e185b1e5bf3c0b34ffd86a40a6ebb35b78c6b89a60672b92bdb6aabef6521877e50daee23770fba14191dc5720aa027b42bae5fbf16982bb62a83f375f21fda83c46b4813fbb1680b99bb1ba006febdadf3ab6e101804d77a6df4a4658de45093491e04f2277499de27ab36b07593e18518f65cb409aa3b401965f69e6642dc7dbceb5eb5b0724df1627e2b830973438e2478be82c04d9aa9395c3c3dc54dd920202c150735f33f4c5ac2f45dba04f7e89000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000360c6ebe',
    },
    {
        id: 'ethereum/0x7f97a6f46b092a9b2c200c60fa7048c6b30ba1bbb8fca2ffb8b6d750c3a8f5d7',
        signature: 'guessed_b089fef4(bytes,address[])',
        calldata:
            '0xb089fef400000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000d400000000000000000000000000000000000000000000000000000000000000cc40965d04b00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000c8000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000420000000000000000000000000000000000000000000000000000000000000048000000000000000000000000000000000000000000000000000000000ee6b28000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009bc8430b2577b5a268bb3c5c0200000000000000000000000084d99aa569d93a9ca187d83734c8c4a519c4e9b163ea00cb0000b4014dc300000000000000000000000000000000014442cdb289000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb48000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000086f35cbfa96d6d143055b787c188cc49d6e6570a0000000000000000000000008290dbccb15b5a516deee2805c58e56075d6605e000000000000000000000000a88800cd213da5ae406ce248380802bd53b4764700000000000000000000000000000000000000000000000000000000ee6b28000000000000000000000000000000000000000000000000002507a501024277030000014000000118000001180000002400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001c72cc2878d000063ea017a00000000000086f35cbfa96d6d143055b787c188cc49d6e6570aa0b86991c6218b36c1d19d4a2e9eb0ce3606eb4800000000000000000000000086f35cbfa96d6d143055b787c188cc49d6e6570a0000000000000000000000001111111254eeb25477b68fb85ed929f73a960582ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000063eb520f000000000000000000000000000000000000000000000000000000000000001c67396bd29c811a671fe8ca95a58734049408cd19be80c4aa6fdd52bd859a8700208a15eaf877298d3f33308eff22f42c13cb6d0c4b4ab375b2c5a68d901ed3cc8290dbccb15b5a516deee2805c58e56075d6605e86f35cbfa96d6d143055b787c188cc49d6e6570a006c000004001800c4fb0000000084d99aa569d93a9ca187d83734c8c4a519c4e9b100000000c2abef778dcc046939eccfa33edbd8833174dc7b000000009108813f22637385228a1c621c1904bbbc50dc2500000000ad7149152a65e6ec97add7b1b1f917dcafcf9b210000000069313aec23db7e4e8788b942850202bcb6038734ffffffff2a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040bb273085a90b48b0bcceadf7362ddf8476caef61323a16394b2a5a6d26beb551cc6f5d67eca576c7adbe04c99c4b7dd4f3fb4d210d73c8d149d25dd7a26993c500000000000000000000000000000000000000000000000000000000000007d5a88800cd213da5ae406ce248380802bd53b476470000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000003600000000000000000000000000000000000000000000000000000000005f5e1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009bc8430b2577b5a268bb3c5c020000000000000000000000000d4a11d5eeaac28ec3f61d100daf4d40471f185263ea00d70000b4187b6f0000000000000000000000000000000000bad6fae72d000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec7000000000000000000000000d38bb40815d2b0c2d2c866e0c72c5728ffc76dd90000000000000000000000003350206f89b4e07670c470f273473b2b7325633d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a88800cd213da5ae406ce248380802bd53b476470000000000000000000000000000000000000000000000000000000005f5e100000000000000000000000000000000000000000000000031214db55b63528e880000002400000024000000240000002400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000a12cc2878d000063ea01860000000000003350206f89b4e07670c470f273473b2b7325633d0000000084d99aa569d93a9ca187d83734c8c4a519c4e9b100000000c2abef778dcc046939eccfa33edbd8833174dc7b000000009108813f22637385228a1c621c1904bbbc50dc2500000000ad7149152a65e6ec97add7b1b1f917dcafcf9b210000000069313aec23db7e4e8788b942850202bcb6038734ffffffff28000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040ce4ded7a7b3556102f5fd189a8f74f88ca6a10cb2bcd15a1a32b2c2887b26ac47f6e6c9d6113b74f248621175465bbcf59f7b10384d51a2328973274c97f4d8d0000000000000000000000000000000000000000000000000000000000000429a88800cd213da5ae406ce248380802bd53b476470184d99aa569d93a9ca187d83734c8c4a519c4e9b10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000003ca0b86991c6218b36c1d19d4a2e9eb0ce3606eb48a77c88abcaa770c54a6cfbfd0c586a475537bbc1a77c88abcaa770c54a6cfbfd0c586a475537bbc1000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001c00000000000000000000000000000000000000000000000000000000000000044a9059cbb000000000000000000000000a77c88abcaa770c54a6cfbfd0c586a475537bbc100000000000000000000000000000000000000000000000000000000ee6b28000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a5d9c4535700000000000000000000000000000000000000000000000000000000006302a00000000000000000000000000000000000000000000000000000000000000001ee63c1e58188e6a0c2ddd26feeb64f039a2c41296fcb3f5640a0b86991c6218b36c1d19d4a2e9eb0ce3606eb4884d99aa569d93a9ca187d83734c8c4a519c4e9b100000000000000000000000000000000000000000000000000000000ee6b28000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000134d9c453570000000000000000000000000000000000000000000000000000000000f200a007e5c0d20000000000000000000000000000000000000000000000000000ce00006700206ae4071138002dc6c00d4a11d5eeaac28ec3f61d100daf4d40471f185233d39ea02d1a569ecc77fbfcbbdcd4300fa0b0100000000000000000000000000000000000000000000000000000000000000001dac17f958d2ee523a2206206994597c13d831ec700206ae40711b8002dc6c033d39ea02d1a569ecc77fbfcbbdcd4300fa0b01084d99aa569d93a9ca187d83734c8c4a519c4e9b10000000000000000000000000000000000000000000000000000000000000001c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000000000005f5e10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000d38bb40815d2b0c2d2c866e0c72c5728ffc76dd9',
    },
];

// returns true if the param can't be encoded in the static section of calldata
const isParamDynamic = (param: ParamType): boolean => {
    if (param.baseType === 'bytes' || param.baseType === 'string') {
        return true;
    }
    if (param.baseType === 'array') {
        if (param.arrayLength === -1) {
            return true;
        }

        return isParamDynamic(param.arrayChildren!);
    }
    if (param.baseType === 'tuple') {
        return param.components!.find(isParamDynamic) !== undefined;
    }
    return false;
};

// we strip some information from the expected fragment to reflect the realities of what the guesser can recover
// 1) if there is a tuple which does not contain any dynamic components, it won't have a length and therefore
//    will be indistinguishable from not having a tuple at all
//    ex: func(uint256,(bytes4,bytes32),uint8) === func(uint256,bytes4,bytes32,uint8)
//    however: func(uint256,(string,bytes32),uint8) !== func(uint256,string,bytes32,uint8)
// 2) if there is a dynamic array with no children, it will be impossible to recover the types of its children (duh)
//    ex: func((uint256,string,bytes)[],uint256) === func(string,uint256) if the first parameter has no children
// 3) if there is a static array, it will look identical to the elemented repeated
//    ex: func(uint256[3]) === func(uint256,uint256,uint256)
const stripTypeInformation = (params: readonly ParamType[], allArgs: any[][], isParentArray?: boolean): ParamType[] => {
    const strippedParams: ParamType[] = [];
    for (const [idx, param] of params.entries()) {
        if (param.isTuple()) {
            const remappedComponents = stripTypeInformation(
                param.components,
                allArgs.map((args) => args[idx]),
            );

            const shouldBeFlattened = param.components!.find(isParamDynamic) === undefined;
            if (shouldBeFlattened && !isParentArray) {
                // rule 1
                strippedParams.push(...remappedComponents);
            } else {
                strippedParams.push(ParamType.from(`(${remappedComponents.map((v) => v.format()).join(',')})`));
            }
        } else if (param.isArray()) {
            if (param.arrayLength !== -1) {
                // rule 3
                for (let i = 0; i < param.arrayLength; i++) {
                    strippedParams.push(param.arrayChildren);
                }
            } else {
                const anyArgsHaveElements = allArgs.find((args) => args[idx].length > 0) !== undefined;
                if (!anyArgsHaveElements) {
                    // rule 2
                    strippedParams.push(ParamType.from('()[]'));
                } else {
                    const remappedChildren = stripTypeInformation(
                        Array(allArgs.length).fill(param.arrayChildren),
                        allArgs.map((args) => args[idx]),
                        true,
                    )[0];
                    strippedParams.push(ParamType.from(`${remappedChildren.format()}[]`));
                }
            }
        } else if (param.baseType === 'bytes' || param.baseType === 'string') {
            const anyArgsHaveElements =
                allArgs.find((args) => args[idx].length > (param.baseType === 'bytes' ? 2 : 0)) !== undefined;
            if (!anyArgsHaveElements) {
                // rule 2
                strippedParams.push(ParamType.from('()[]'));
            } else {
                strippedParams.push(param);
            }
        } else {
            strippedParams.push(param);
        }
    }

    return strippedParams;
};

const isEqual = (expectedFragment: FunctionFragment, actualFragment: FunctionFragment) => {
    const normalize = (type: string) => {
        if (/^uint[0-9]+$/g.test(type)) return 'uint256';
        else if (/^int[0-9]+$/g.test(type)) return 'int256';
        else if (/^bytes[0-9]+$/g.test(type)) return 'uint256';
        else if (type === 'bool') return 'uint256';
        else if (type === 'string') return 'bytes';
        else if (type === 'address') return 'uint256';

        return type;
    };

    const compareParams = (left: readonly ParamType[], right: readonly ParamType[]) => {
        if (left.length !== right.length) {
            throw new Error(
                `${left.length} != ${right.length} (${left.map((v) => v.format()).join(',')} != ${right
                    .map((v) => v.format())
                    .join(',')})`,
            );
        }

        for (let i = 0; i < left.length; i++) {
            const leftChild = left[i];
            const rightChild = right[i];

            if (leftChild.baseType === 'array') {
                if (leftChild.baseType !== rightChild.baseType) {
                    throw new Error(`${leftChild.baseType} != ${rightChild.baseType}`);
                }

                if (leftChild.arrayLength != rightChild.arrayLength) {
                    throw new Error(`${leftChild.arrayLength} != ${rightChild.arrayLength}`);
                }

                compareParams([leftChild.arrayChildren!], [rightChild.arrayChildren!]);
            } else if (leftChild.baseType === 'tuple') {
                if (leftChild.baseType !== rightChild.baseType) {
                    throw new Error(`${leftChild.baseType} != ${rightChild.baseType}`);
                }

                compareParams(leftChild.components!, rightChild.components!);
            } else {
                const leftType = normalize(leftChild.type);
                const rightType = normalize(rightChild.type);

                if (leftType !== rightType) {
                    throw new Error(`${leftChild.type} !== ${rightChild.type}`);
                }
            }
        }
    };

    compareParams(expectedFragment.inputs!, actualFragment.inputs);
};

describe('guess', () => {
    handwrittenTestcases.forEach((testcase) => {
        it('should be able to guess ' + testcase.name + ': ' + testcase.signature, async () => {
            const fragment = FunctionFragment.from(testcase.signature);
            const data =
                fragment.selector + AbiCoder.defaultAbiCoder().encode(fragment.inputs, testcase.args).substring(2);

            const guessed = guessFragment(data);
            if (!guessed) {
                throw new Error('failed to parse');
            }

            console.log('guessed function ', guessed.format());
            const strippedFragment = FunctionFragment.from(
                `${fragment.name}(${stripTypeInformation(fragment.inputs!, [testcase.args])
                    .map((v) => v.format())
                    .join(',')})`,
            );
            console.log('expected function', strippedFragment.format());
            try {
                isEqual(strippedFragment, guessed);
            } catch (e) {
                console.log('failed', e);
                throw new Error(`failed: ${fragment.format()}, ${guessed.format()}, ${e}`);
            }
        });
    });
    chainTestcases.forEach((testcase) => {
        it('should work on ' + testcase.id, async () => {
            const fragment = FunctionFragment.from(testcase.signature);

            const guessed = guessFragment(testcase.calldata);
            if (!guessed) {
                throw new Error('failed to parse');
            }

            console.log('guessed function ', guessed.format());
            const strippedFragment = FunctionFragment.from(
                `${fragment.name}(${stripTypeInformation(fragment.inputs, [
                    AbiCoder.defaultAbiCoder()
                        .decode(fragment.inputs, '0x' + testcase.calldata.substring(10))
                        .map((v) => v),
                ])
                    .map((v) => v.format())
                    .join(',')})`,
            );
            console.log('expected function', strippedFragment.format());
            try {
                isEqual(strippedFragment, guessed);
            } catch (e) {
                console.log('failed', e);
                throw new Error(`failed: ${fragment.format()}, ${guessed.format()}, ${e}`);
            }
        });
    });
});
